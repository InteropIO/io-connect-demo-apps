"use strict";(self.webpackChunkts_acme_oms=self.webpackChunkts_acme_oms||[]).push([[67],{2316:function(n,e,t){t.d(e,{Z:function(){return g}});var r=t(885),o=t(4165),i=t(5861),a=t(2791),u=t(9293),c=t(5155),s=function(n){var e=(0,a.useState)(),t=(0,r.Z)(e,2),o=t[0],i=t[1],u=(0,a.useState)(),c=(0,r.Z)(u,2),s=c[0],d=c[1],l=(0,a.useState)(),f=(0,r.Z)(l,2),v=f[0],p=f[1];(0,a.useEffect)((function(){if(n){var e=void 0;try{console.log("Subscribing to window channels"),e=n.channels.subscribe(w)}catch(t){console.error(t)}return function(){var n;console.log("Unsubscribing from window channels"),null===(n=e)||void 0===n||n()}}}),[n]);var w=function(n,e,t){i(n),d(e),p(t)};return[o,s,v]},d=function(n){return"___workspace___"+n},l=function(){var n=(0,i.Z)((0,o.Z)().mark((function n(e,t,r){return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if((null===t||void 0===t?void 0:t.id)===(null===e||void 0===e?void 0:e.windows.my().id)){n.next=2;break}return n.abrupt("return");case 2:console.log("added to workspace:",t.workspaceId),r.setWorkspaceId(t.workspaceId),r.setContextName(d(t.workspaceId));case 5:case"end":return n.stop()}}),n)})));return function(e,t,r){return n.apply(this,arguments)}}(),f=function(){var n=(0,i.Z)((0,o.Z)().mark((function n(e,t,r){return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.windowId===(null===e||void 0===e?void 0:e.windows.my().id)){n.next=3;break}return n.abrupt("return");case 3:console.log("removed from workspace"),r.setWorkspaceId("");case 5:case"end":return n.stop()}}),n)})));return function(e,t,r){return n.apply(this,arguments)}}(),v=function(n){var e=(0,a.useState)(""),t=(0,r.Z)(e,2),u=t[0],s=t[1],v=(0,c.Z)(n,u),p=(0,r.Z)(v,1)[0],w=(0,a.useState)(""),m=(0,r.Z)(w,2),h=m[0],x=m[1];return(0,a.useEffect)((function(){if(n){var e=void 0,t=void 0;try{var r,o;console.log("Subscribing to workspaces window added"),e=null===(r=n.workspaces)||void 0===r?void 0:r.onWindowAdded((function(e){l(n,e,{setContextName:s,setWorkspaceId:x})})),console.log("Subscribing to workspaces window removed"),t=null===(o=n.workspaces)||void 0===o?void 0:o.onWindowRemoved((function(e){f(n,e,{setContextName:s,setWorkspaceId:x})}))}catch(i){console.error(i)}return function(){var n,r;null===(n=e)||void 0===n||n.then((function(n){console.log("Unsubscribing from workspaces window added"),n()})).catch(console.error),null===(r=t)||void 0===r||r.then((function(n){console.log("Unsubscribing from workspaces window removed"),n()})).catch(console.error)}}}),[n]),(0,a.useEffect)((function(){(0,i.Z)((0,o.Z)().mark((function e(){var t,r;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===n||void 0===n||null===(t=n.workspaces)||void 0===t?void 0:t.getMyWorkspace().catch((function(n){return null}));case 2:(r=e.sent)&&(x(r.id),s(d(r.id)));case 4:case"end":return e.stop()}}),e)})))()}),[n]),[p,h,u]},p=t(1211),w=function(n){var e;if(n){var t=null===n||void 0===n||null===(e=n.instrument)||void 0===e?void 0:e.id;return(null===t||void 0===t?void 0:t.RIC)||""}},m=t(6074),h=t(184),x=function(){var n=(0,i.Z)((0,o.Z)().mark((function n(e,t,r,i){var a,u,c,s,d;return(0,o.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a=t.value,u=a,c=(r.value||r.chan)&&void 0!==t.chan,s=(r.value||r.glob)&&void 0!==t.glob,d=(r.value||r.ws)&&void 0!==t.ws,n.t0=c,!n.t0){n.next=10;break}return n.next=9,i.chan();case 9:n.t0=n.sent;case 10:if(!n.t0){n.next=12;break}u=t.chan;case 12:if(n.t1=s,!n.t1){n.next=17;break}return n.next=16,i.glob();case 16:n.t1=n.sent;case 17:if(!n.t1){n.next=19;break}u=t.glob;case 19:if(n.t2=d,!n.t2){n.next=24;break}return n.next=23,i.ws();case 23:n.t2=n.sent;case 24:if(!n.t2){n.next=26;break}u=t.ws;case 26:u!==a&&(t.value=u,null===e||void 0===e||e(u));case 27:case"end":return n.stop()}}),n)})));return function(e,t,r,o){return n.apply(this,arguments)}}(),k={chan:function(){return p.Z.evaluateCondition("sync.instrument.in.channel")},ws:function(){return p.Z.evaluateCondition("sync.instrument.in.wsContext")},glob:function(){return p.Z.evaluateCondition("sync.instrument.in.globalContext")}},Z=function(n){var e=n.instrumentSetter,t=(0,a.useContext)(u.zq);(0,a.useEffect)((function(){return console.log("ContextHandler loaded"),function(){console.log("ContextHandler reloading...")}}),[]);var o=(0,a.useRef)({value:""}),i=s(t),d=(0,r.Z)(i,2),l=d[0],f=d[1],p=(0,c.Z)(t,m.x),Z=(0,r.Z)(p,1)[0],g=v(t),b=(0,r.Z)(g,2),y=b[0],C=b[1];return(0,a.useEffect)((function(){if(e){o.current.chan=w(l);var n=f?{chan:!0}:{value:!0};x(e,o.current,n,k)}}),[l,f,e]),(0,a.useEffect)((function(){if(e){o.current.glob=w(Z);x(e,o.current,{glob:!0},k)}}),[Z,e]),(0,a.useEffect)((function(){if(e){o.current.ws=w(y);x(e,o.current,{ws:!0},k)}}),[y,C,e]),(0,h.jsx)("div",{style:{display:"none"}})},g=a.memo(Z)},9067:function(n,e,t){t.r(e),t.d(e,{default:function(){return H}});var r=t(885),o=t(2791),i=t(4165),a=t(5861),u=t(9293),c=t(5163),s=t(1009),d=t(2953),l=t(7497),f=(t(4022),t(1778),t(8748),t(8702),t(7251)),v=t(4979),p=t(2891),w=t(3123),m=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e,t,r){var o;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return o=e.interop,n.next=3,o.invoke("T42.OMS.GetOrder",{orderId:t,withTrades:!0,date:r||new Date}).then((function(n){var e,t=n.returned;return{order:null===t||void 0===t?void 0:t.order,trades:null!==(e=null===t||void 0===t?void 0:t.trades)&&void 0!==e?e:[]}}));case 3:return n.abrupt("return",n.sent);case 4:case"end":return n.stop()}}),n)})));return function(e,t,r){return n.apply(this,arguments)}}(),h=t(3421);var x=t(3818),k=t(4423),Z=t(6838),g=t(2957),b=t(5671),y=t(3144),C=function(){function n(e){(0,b.Z)(this,n),this.delay=500,this.latestAction=void 0,this.timeoutId=void 0,this.setDelay(e)}return(0,y.Z)(n,[{key:"performAction",value:function(){var n=this.latestAction;this.cancel(),"function"===typeof n&&n()}},{key:"clearTimeout",value:function(n){function e(){return n.apply(this,arguments)}return e.toString=function(){return n.toString()},e}((function(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=void 0)}))},{key:"setDelay",value:function(n){"number"===typeof n&&(this.delay=n)}},{key:"action",value:function(n){this.timeoutId||(this.timeoutId=setTimeout(this.performAction.bind(this),this.delay)),this.latestAction=n}},{key:"cancel",value:function(){this.latestAction=void 0,this.clearTimeout()}}]),n}(),D=t(503),I=t(2316),S=t(670),T=t(184),E=new C(300),F={resizable:!0,filter:!0,sortable:!0,enableCellChangeFlash:!0},R=void 0;var _=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e,t){var r,o,a;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,null===(r=R)||void 0===r?void 0:r.interop.invoke(l.aV,{orderId:parseInt(e),withTrades:!0,date:t});case 2:return a=n.sent,n.abrupt("return",(null===a||void 0===a||null===(o=a.returned)||void 0===o?void 0:o.trades)||[]);case 4:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),z=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e,t){var r,o,a;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,null===(r=R)||void 0===r?void 0:r.interop.invoke(l.BD,{date:t,instrument:e});case 2:return a=n.sent,n.abrupt("return",(null===a||void 0===a||null===(o=a.returned)||void 0===o?void 0:o.trades)||[]);case 4:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),N=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){var t,r,o;return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,null===(t=R)||void 0===t?void 0:t.interop.invoke(l.oA,{date:e});case 2:return o=n.sent,n.abrupt("return",(null===o||void 0===o||null===(r=o.returned)||void 0===r?void 0:r.trades)||[]);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),A=function(n){var e,t=n.intentOrder,l=n.intentInstrument;R=(0,o.useContext)(u.zq);var b=(0,c.Z)();window.grid=b;var y=(0,o.useState)(),C=(0,r.Z)(y,2),A=C[0],H=C[1],j=(0,o.useState)(new Date),q=(0,r.Z)(j,2),G=q[0],M=q[1],O=(0,D.Q)(R).mockTimeOffset,L=(0,o.useState)(""),W=(0,r.Z)(L,2),B=W[0],U=W[1],X=(0,o.useState)(""),Q=(0,r.Z)(X,2),V=Q[0],Y=Q[1],J=(0,p.Z)(),K=J.instrumentContext,P=J.publish,$=(0,Z.E)(),nn=function(){var n=(0,o.useContext)(u.zq),e=(0,w.a)(),t=function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r,o){var a,u,c,s,d,l,v;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(n,r,o);case 2:return u=t.sent,c=u.order,s=u.trades,d=o||new Date,l=null===e||void 0===e||null===(a=e.find((function(n){var e=n.clientId;return(null===c||void 0===c?void 0:c.clientId)===e})))||void 0===a?void 0:a.email,v=s.map((function(n){return(0,h.f3)(n)})),t.next=10,n.interop.invoke("T42.ShareTradeHistoryEmail",{trades:v,startDate:(0,f.Dn)(d),endDate:d,contactList:{type:"fdc3.contactList",contacts:[{type:"fdc3.contact",id:{email:l}}]}}).catch(console.error);case 10:case"end":return t.stop()}}),t)})));return function(n,e){return t.apply(this,arguments)}}();return(0,o.useCallback)(t,[n,e])}(),en=function(){var n=(0,o.useContext)(u.zq),e=(0,w.a)(),t=function(){var t=(0,a.Z)((0,i.Z)().mark((function t(r,o){var a,u,c,s,d,l,v;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m(n,r,o);case 2:return u=t.sent,c=u.order,s=u.trades,d=null===e||void 0===e||null===(a=e.find((function(n){var e=n.clientId;return c.clientId===e})))||void 0===a?void 0:a.email,l=o||new Date,v=s.map((function(n){return(0,h.f3)(n)})),t.next=10,n.interop.invoke("T42.ShareTradeHistoryChat",{trades:v,startDate:(0,f.Dn)(l),endDate:l,contactList:{type:"fdc3.contactList",contacts:[{type:"fdc3.contact",id:{email:d}}]}}).catch(console.error);case 10:case"end":return t.stop()}}),t)})));return function(n,e){return t.apply(this,arguments)}}();return(0,o.useCallback)(t,[n,e])}(),tn=function(){var n=(0,o.useContext)(u.zq),e=function(){var e=(0,a.Z)((0,i.Z)().mark((function e(t,r){var o,a,u,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,m(n,t,r);case 2:return o=e.sent,a=o.trades,u=r||new Date,c=a.map((function(n){return(0,h.f3)(n)})),e.next=8,n.interop.invoke("T42.ShareTradeHistoryExcel",{trades:c,startDate:(0,f.Dn)(u),endDate:u}).catch(console.error);case 8:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();return(0,o.useCallback)(e,[n])}(),rn=(0,g.j)().syncInstrument,on=(0,S.Z)();(0,s.mr)(null===b||void 0===b||null===(e=b.api)||void 0===e?void 0:e.getSelectedNodes(),K);(0,o.useEffect)((function(){var n=function(){return M(new Date)};window.addEventListener("hashchange",n);var e=setInterval((function(){n()}),1e4);return function(){window.removeEventListener("hashchange",n),clearInterval(e)}}),[]),(0,o.useEffect)((function(){var n="number"===typeof O?new Date(G.getTime()+O):G;B?E.action((0,a.Z)((0,i.Z)().mark((function e(){var t,r,o,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(B,n);case 2:a=e.sent,null===(t=R)||void 0===t||null===(r=t.windows)||void 0===r||null===(o=r.my())||void 0===o||o.setTitle("Trades: Order ".concat(B)),H(a);case 5:case"end":return e.stop()}}),e)})))):V?E.action((0,a.Z)((0,i.Z)().mark((function e(){var t,r,o,a,u;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={type:"fdc3.instrument",id:{ticker:(0,h.Eb)(V)}},e.next=3,z(a,n);case 3:u=e.sent,null===(t=R)||void 0===t||null===(r=t.windows)||void 0===r||null===(o=r.my())||void 0===o||o.setTitle("Trades: ".concat(V)),H(u);case 6:case"end":return e.stop()}}),e)})))):E.action((0,a.Z)((0,i.Z)().mark((function e(){var t,r,o,a;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,N(n);case 2:a=e.sent,null===(t=R)||void 0===t||null===(r=t.windows)||void 0===r||null===(o=r.my())||void 0===o||o.setTitle("Trade History"),H(a);case 5:case"end":return e.stop()}}),e)}))))}),[G,B,V,O]),(0,o.useEffect)((function(){if(t){var n=t.id;n&&(0,a.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,h._v)(50);case 2:U(n);case 3:case"end":return e.stop()}}),e)})))()}else U("")}),[t]),(0,o.useEffect)((function(){if(l){var n=null===l||void 0===l?void 0:l.id,e=(null===n||void 0===n?void 0:n.BBG)||(null===n||void 0===n?void 0:n.RIC),t=(0,h.xq)((0,h.Vh)(e));t&&(Y(t),U(""))}else Y("")}),[l]);var an=function(){var n=(0,a.Z)((0,i.Z)().mark((function n(e){return(0,i.Z)().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,P({ticker:e.data.instrument.ticker,BBG_EXCHANGE:e.data.instrument.bbgExchange});case 2:rn(e.data.instrument.ticker),on(e.data.instrument);case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("div",{className:"trade-orders-grid d-flex flex-column flex-grow-1",children:(0,T.jsx)("div",{className:"ag-tick42 flex-grow-1",children:(0,T.jsx)(d.AgGridReact,{getContextMenuItems:function(n){var e,t=null===(e=n.node)||void 0===e?void 0:e.data,r=n.api.getSelectedNodes(),o=n.node;if(o&&void 0===r.find((function(n){return n.rowIndex===o.rowIndex}))&&(r=[o]),r.length<=0)return[];var i=r.map((function(n){var e=n.data.instrument;return{ticker:e.ticker,bbgExchange:e.bbgExchange}}));console.log(i);var a=function(n){var e=new Date;return(0,f.hM)(n,e)?e:(0,f.U)(n)}(t.timestamp);return t?[{name:"Click to Report (Trades) via Email",action:function(){return nn(t.orderId,a)}},{name:"Click to Report (Trades) via Excel",action:function(){return tn(t.orderId,a)}},{name:"Click to Report (Trades) via Chat",action:function(){return en(t.orderId,a)}},{name:"Click to Track",action:function(){(0,x.g)(i,R,k.ue)}}]:[]},defaultColDef:F,rowData:A,context:{sidesMap:$},immutableData:!0,rowSelection:"multiple",getRowNodeId:function(n){return n.sliceId.toString()+n.timestamp.toISOString()},onRowDataChanged:function(n){console.log(n),n.api.sizeColumnsToFit()},columnDefs:v.sX,onGridReady:function(n){b.onGridReady(n),null===n||void 0===n||n.api.sizeColumnsToFit()},onGridSizeChanged:function(n){n.api.sizeColumnsToFit()},onRowClicked:an,cellFlashDelay:200,cellFadeDelay:500,children:(0,T.jsx)(d.AgGridColumn,{field:"Loading Data ..."})})})}),(0,T.jsx)(I.Z,{instrumentSetter:function(n){console.log("Setting instrument from dynamic context:",n),n&&(Y(n),U(""))}})]})};function H(){var n=(0,o.useState)(),e=(0,r.Z)(n,2),t=e[0],i=e[1],a=(0,o.useState)(),u=(0,r.Z)(a,2),c=u[0],d=u[1],l=(0,o.useCallback)((function(n){console.log("viewTradeHistoryForOrder:",n),i(n)}),[]);(0,s.mD)(k.Ft,l);var f=(0,o.useCallback)((function(n){console.log("viewTradeHistoryForInstrument:",n),d(n)}),[]);return(0,s.ZX)(k.Tl,f),(0,T.jsx)("div",{className:"orders-page d-flex flex-column flex-grow-1",children:(0,T.jsx)(A,{intentOrder:t,intentInstrument:c})})}},3123:function(n,e,t){t.d(e,{a:function(){return u}});var r=t(885),o=t(9293),i=t(2791),a=t(7497),u=function(){var n=(0,i.useContext)(o.zq),e=(0,i.useState)([]),t=(0,r.Z)(e,2),u=t[0],c=t[1];return(0,i.useEffect)((function(){n.interop.invoke(a.SZ).then((function(n){var e;return c(null===(e=n.returned)||void 0===e?void 0:e.clients)})).catch((function(n){console.error("Failed invoking ".concat(a.SZ,". Error: "),n)}))}),[n]),u}},670:function(n,e,t){t.d(e,{Z:function(){return u}});var r=t(9293),o=t(2791),i=t(3421),a=t(4423);function u(){var n=(0,o.useContext)(r.zq);return(0,o.useCallback)((function(e){var t=(0,i.qS)(e);t&&(null===n||void 0===n||n.intents.raise({intent:a.DB,context:{type:t.type,data:t}}))}),[n])}},7251:function(n,e,t){t.d(e,{Dn:function(){return o},Q_:function(){return c},U:function(){return i},hM:function(){return u},tv:function(){return r}});var r=function(n,e){var t=new Date(n);return t.setDate(t.getDate()+e),t},o=function(n){var e=new Date(n);return e.setHours(0,0,0,0),e},i=function(n){var e=new Date(n);return e.setHours(23,59,59,999),e},a=function(n){return!!n&&!isNaN(n.getTime())},u=function(n,e){return n&&e&&n.getDate()===e.getDate()&&n.getMonth()===e.getMonth()&&n.getFullYear()===e.getFullYear()},c=function(n){var e=void 0;if(n)if(n instanceof Date)a(n)&&(e=n);else if("string"===typeof n){var t=new Date(n);a(t)&&(e=t)}return e}}}]);
//# sourceMappingURL=67.23746275.chunk.js.map