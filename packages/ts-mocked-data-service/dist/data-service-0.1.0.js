/*! For license information please see data-service-0.1.0.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MockDataGenerator=t():e.MockDataGenerator=t()}(self,(()=>(()=>{var e={48:(e,t,r)=>{var n=r(319).default;function i(){"use strict";e.exports=i=function(){return r},e.exports.__esModule=!0,e.exports.default=e.exports;var t,r={},o=Object.prototype,a=o.hasOwnProperty,s=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",d=c.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(t){p=function(e,t,r){return e[t]=r}}function f(e,t,r,n){var i=t&&t.prototype instanceof O?t:O,o=Object.create(i.prototype),a=new M(n||[]);return s(o,"_invoke",{value:D(e,r,a)}),o}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}r.wrap=f;var m="suspendedStart",y="suspendedYield",v="executing",g="completed",b={};function O(){}function P(){}function w(){}var T={};p(T,u,(function(){return this}));var x=Object.getPrototypeOf,S=x&&x(x(R([])));S&&S!==o&&a.call(S,u)&&(T=S);var k=w.prototype=O.prototype=Object.create(T);function I(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function G(e,t){function r(i,o,s,c){var u=h(e[i],e,o);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==n(d)&&a.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,s,c)}),(function(e){r("throw",e,s,c)})):t.resolve(d).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,c)}))}c(u.arg)}var i;s(this,"_invoke",{value:function(e,n){function o(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(o,o):o()}})}function D(e,r,n){var i=m;return function(o,a){if(i===v)throw new Error("Generator is already running");if(i===g){if("throw"===o)throw a;return{value:t,done:!0}}for(n.method=o,n.arg=a;;){var s=n.delegate;if(s){var c=N(s,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===m)throw i=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=v;var u=h(e,r,n);if("normal"===u.type){if(i=n.done?g:y,u.arg===b)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=g,n.method="throw",n.arg=u.arg)}}}function N(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,N(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var o=h(i,e.iterator,r.arg);if("throw"===o.type)return r.method="throw",r.arg=o.arg,r.delegate=null,b;var a=o.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function R(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function r(){for(;++i<e.length;)if(a.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(n(e)+" is not iterable")}return P.prototype=w,s(k,"constructor",{value:w,configurable:!0}),s(w,"constructor",{value:P,configurable:!0}),P.displayName=p(w,d,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===P||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,w):(e.__proto__=w,p(e,d,"GeneratorFunction")),e.prototype=Object.create(k),e},r.awrap=function(e){return{__await:e}},I(G.prototype),p(G.prototype,l,(function(){return this})),r.AsyncIterator=G,r.async=function(e,t,n,i,o){void 0===o&&(o=Promise);var a=new G(f(e,t,n,i),o);return r.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},I(k),p(k,d,"Generator"),p(k,u,(function(){return this})),p(k,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},r.values=R,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,i){return s.type="throw",s.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var c=a.call(o,"catchLoc"),u=a.call(o,"finallyLoc");if(c&&u){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;j(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:R(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),b}},r}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},319:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},799:(e,t,r)=>{var n=r(48)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var n={};return(()=>{"use strict";function e(e,t,r,n,i,o,a){try{var s=e[o](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,i)}function t(t){return function(){var r=this,n=arguments;return new Promise((function(i,o){var a=t.apply(r,n);function s(t){e(a,i,o,s,c,"next",t)}function c(t){e(a,i,o,s,c,"throw",t)}s(void 0)}))}}r.d(n,{default:()=>ye});var i=r(799),o=r.n(i);function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function c(e){var t=function(e,t){if("object"!=s(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!=s(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==s(t)?t:String(t)}function u(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function l(e,t,r){return t&&u(e.prototype,t),r&&u(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function d(e,t,r){return(t=c(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var p="https://tools.morningstar.co.uk/uk/stockreport/default.aspx?Site=uk&id=",f=[{ticker:"AZN",bbgExchange:"LN",isin:"GB0009895292",description:"AstraZeneca Plc",currency:"GBX",price:{close:9138,yearLow:6499.8,yearHigh:9258.4},volume:{average:2120914},url:p+"0P00007NYP"},{ticker:"BCS",bbgExchange:"LN",isin:"GB0031348658",description:"Barclays Plc",currency:"GBX",price:{close:200.85,yearLow:106.76,yearHigh:217.63},volume:{average:36564354},url:p+"0P00007NZP"},{ticker:"BTI",bbgExchange:"LN",isin:"GB0002875804",description:"British American Tobacco Plc",currency:"GBX",price:{close:2552.5,yearLow:2467,yearHigh:2961.5},volume:{average:3106768},url:p+"0P00007O1O"},{ticker:"DEO",bbgExchange:"LN",isin:"GB0002374006",description:"Diageo Plc",currency:"GBX",price:{close:3656.5,yearLow:2500,yearHigh:3715.5},volume:{average:2687770},url:p+"0P00007O7R"},{ticker:"HSBC",bbgExchange:"LN",isin:"GB0005405286",description:"HSBC Holdings Plc ORD",currency:"GBX",price:{close:495,yearLow:329.55,yearHigh:501.4},volume:{average:25927255},url:p+"0P00007OFH"},{ticker:"LYG",bbgExchange:"LN",isin:"GB0008706128",description:"Lloyds Banking Group Plc",currency:"GBX",price:{close:52.89,yearLow:30.82,yearHigh:53.41},volume:{average:183324950},url:p+"0P000090RG"},{ticker:"RIO",bbgExchange:"LN",isin:"GB0007188757",description:"Rio Tinto ORD",currency:"GBX",price:{close:72.71,yearLow:59.58,yearHigh:95.97},volume:{average:3552688},url:p+"0P00007OTS"},{ticker:"VOD",bbgExchange:"LN",isin:"GB00BH4HKS39",description:"Vodafone Group Plc",currency:"GBX",price:{close:109.36,yearLow:100,yearHigh:157.52},volume:{average:64071830},url:p+"0P00007WPO"},{ticker:"TSLA",bbgExchange:"US",isin:"US88160R1014",description:"Tesla, Inc",currency:"US",price:{close:187.71,yearLow:101.81,yearHigh:384.29},volume:{average:151897763},url:p+"0P00007O1O"}];function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function m(e,t){if(t&&("object"===s(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return h(e)}function y(e){return y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},y(e)}function v(e,t){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},v(e,t)}function g(e,t,r){return t=y(t),m(e,b()?Reflect.construct(t,r||[],y(e).constructor):t.apply(e,r))}function b(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(b=function(){return!!e})()}var O=function(e){var t,r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=3735928559^n,o=1103547991^n;for(t=0;t<e.length;t++)r=e.charCodeAt(t),i=Math.imul(i^r,2654435761),o=Math.imul(o^r,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(o^o>>>13,3266489909),4294967296*(2097151&(o=Math.imul(o^o>>>16,2246822507)^Math.imul(i^i>>>13,3266489909)))+(i>>>0)},P=function(e){function t(e,r,n,i){var o;return a(this,t),d(h(o=g(this,t)),"s1",19088743),d(h(o),"s2",2309737967),d(h(o),"s3",4275878552),d(h(o),"s4",1985229328),e instanceof Date&&(e=e.toISOString().split("T")[0]),"string"==typeof e?(o.s1=O(e,o.s1),o.s2=O(e,o.s2),o.s3=O(e,o.s3),o.s4=O(e,o.s4),m(o)):(o.s1=null!=e?e>>>0:o.s3,o.s2=null!=r?r>>>0:o.s2,o.s3=null!=n?n>>>0:o.s3,o.s4=null!=i?i>>>0:o.s4,o)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(t,e),l(t,[{key:"next32",value:function(){this.s1>>>=0,this.s2>>>=0,this.s3>>>=0,this.s4>>>=0;var e=this.s1+this.s2|0;return this.s1=this.s2^this.s2>>>9,this.s2=this.s3+(this.s3<<3)|0,this.s3=this.s3<<21|this.s3>>>11,this.s4=this.s4+1|0,e=e+this.s4|0,this.s3=this.s3+e|0,e>>>0}}]),t}(function(){function e(){a(this,e)}return l(e,[{key:"next32Range",value:function(e,t){var r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.next32()%(t-e+(r?1:0))+e}}]),e}());const w=function(){function e(t){var r=this;a(this,e),d(this,"glue",void 0),d(this,"generateBids",(function(e){var t,n=e.ticker,i=e.lastPrice;if(i&&n){t=[];for(var o=0;o<3;o++)t.push(r.createOrder(n,i,"1",o)),t.push(r.createOrder(n,i,"2",o))}return{bidData:t}})),d(this,"createOrder",(function(e,t,r,n){var i=new P(n+r),o=i.next32Range(1,10),a=t*(i.next32Range(3,8)/100),s="1"===r?t-a:t+a,c=f.find((function(t){return t.ticker===e})),u=(null==c?void 0:c.volume.average)||1e3*Math.random(),l=.001*u,d=.005*u,p=new P(100*Math.random()+r+e).next32Range(l,d);return{count:o,volume:100*Math.round(p/100),price:+s.toFixed(2),side:r}})),this.glue=t}var r;return l(e,[{key:"initialize",value:(r=t(o().mark((function e(){var t=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.glue.interop.register({name:"T42.OMS.GetBidData",accepts:"string ticker?, number lastPrice?",returns:"BidData[] bids",displayName:"Get Bid Data for instrument",description:"Retrieve a list of bids for instrument"},(function(e){return t.generateBids(e)})).catch((function(e){console.error("Exception while registering method.",e)}));case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})}]),e}();function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function x(e){return function(e){if(Array.isArray(e))return T(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return T(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?T(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var S=[{brokerId:"BROKER1",brokerExchange:"XOFF"},{brokerId:"BROKER2",brokerExchange:"XOFF"}],k=[{clientId:"TEST1",email:"test1.demo@tick42.com",salesforceId:"0030900000aBhKYAA0"},{clientId:"TEST2",email:"test2.demo@tick42.com",salesforceId:"0030900000aBhKhAAK"}],I={type:"fdc3.instrumentList",name:"Default Watchlist",id:{watchlistId:"watchlist_default"},instruments:f.map((function(e){var t=e.description,r=e.ticker,n=e.bbgExchange;return{type:"fdc3.instrument",name:t,id:{ticker:r,BBG_EXCHANGE:n,RIC:"".concat(r," ").concat(n),customID:"_"+Math.random().toString(36).substr(2,9)}}}))};function G(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function D(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?G(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var N=[{name:"GAM Star Disruptive Growth Inst Acc GBP",isin:"IE00B5VMHR51",url:"https://www.morningstar.co.uk/uk/funds/snapshot/snapshot.aspx?id=F00000Q28W",instruments:E([{investment:"AstraZenecaPlc",quantity:77e5,portfolioPercent:7.7},{investment:"British American Tobacco Plc",quantity:67e5,portfolioPercent:6.7},{investment:"Vodafone Group Plc",quantity:34e5,portfolioPercent:3.4},{investment:"Rio Tinto ORD",quantity:32e5,portfolioPercent:3.2},{investment:"Lloyds Banking Group Plc",quantity:28e5,portfolioPercent:2.8},{investment:"Diageo Plc",quantity:28e5,portfolioPercent:2.8},{investment:"Barclays Plc",quantity:25e5,portfolioPercent:2.5},{investment:"Diageo Plc",quantity:24e5,portfolioPercent:2.4}])},{name:"AXA Framlington American Growth Z Acc",isin:"GB00B5LXGG05",url:"https://www.morningstar.co.uk/uk/funds/snapshot/snapshot.aspx?id=F00000NUVE",instruments:E([{investment:"Vodafone Group Plc",quantity:629e4,portfolioPercent:6.29},{investment:"Diageo Plc",quantity:44e5,portfolioPercent:4.4},{investment:"British American Tobacco Plc",quantity:437e4,portfolioPercent:4.37},{investment:"Barclays Plc",quantity:205e4,portfolioPercent:2.05},{investment:"AstraZeneca Plc",quantity:188e4,portfolioPercent:1.88},{investment:"Lloyds Banking Group Plc",quantity:167e4,portfolioPercent:1.82},{investment:"Rio Tinto ORD",quantity:151e4,portfolioPercent:1.51}])},{name:"Baillie Gifford Pacific B Acc",isin:"GB0006063233",url:"https://www.morningstar.co.uk/uk/funds/snapshot/snapshot.aspx?id=F0GBR04RN1",instruments:E([{investment:"HSBC Holdings Plc ORD",quantity:629e4,portfolioPercent:6.29},{investment:"TSMC",quantity:581e4,portfolioPercent:5.81},{investment:"Barclays Plc",quantity:437e4,portfolioPercent:4.37},{investment:"JD.com",quantity:205e4,portfolioPercent:2.05},{investment:"Vodafone Group Plc",quantity:188e4,portfolioPercent:1.88},{investment:"AstraZeneca Plc",quantity:167e4,portfolioPercent:1.67},{investment:"Lloyds Banking Group Plc",quantity:15e5,portfolioPercent:1.5}])},{name:"MS INVF Global Opportunity I USD GBP",isin:"LU0552385295",url:"https://www.morningstar.co.uk/uk/funds/snapshot/snapshot.aspx?id=F00000LNTQ",instruments:E([{investment:"Rio Tinto ORD",quantity:699e4,portfolioPercent:6.99},{investment:"GlaxoSmithKline Plc",quantity:597e4,portfolioPercent:5.97},{investment:"Diageo Plc",quantity:543e4,portfolioPercent:5.43},{investment:"UBER TECHNOLOGIES INC",quantity:502e4,portfolioPercent:5.02},{investment:"Barclays Plc",quantity:474e4,portfolioPercent:4.74},{investment:"HSBC Holdings Plc ORD",quantity:45e5,portfolioPercent:4.5},{investment:"Vodafone Group Plc",quantity:448e4,portfolioPercent:4.48},{investment:"Lloyds Banking Group Plc",quantity:434e4,portfolioPercent:4.34}])},{name:"T. Rowe Price Global Focused Growth Equity Q GBP",isin:"LU1028172499",url:"https://www.morningstar.co.uk/uk/funds/snapshot/snapshot.aspx?id=F00000SZ36",instruments:E([{investment:"GlaxoSmithKline Plc",quantity:501e4,portfolioPercent:5.01},{investment:"Lloyds Banking Group Plc",quantity:474e4,portfolioPercent:4.74},{investment:"Rio Tinto ORD",quantity:368e4,portfolioPercent:3.68},{investment:"Barclays Plc",quantity:337e4,portfolioPercent:3.37},{investment:"AstraZeneca Plc",quantity:321e4,portfolioPercent:3.21},{investment:"British American Tobacco Plc",quantity:299e4,portfolioPercent:2.99},{investment:"Diageo Plc",quantity:275e4,portfolioPercent:2.75},{investment:"HSBC Holdings Plc ORD",quantity:274e4,portfolioPercent:2.74}])}];function E(e){var t=e.map((function(e){return e.investment}));return f.filter((function(e){return t.includes(e.description)})).map((function(t){var r=e.find((function(e){return e.investment===t.description}));return D(D({},t),{},{quantity:(null==r?void 0:r.quantity)||0,portfolioPercent:(null==r?void 0:r.portfolioPercent)||0})}))}var j={1:{displayName:"Buy",shortName:"B",enabled:!0},2:{displayName:"Sell",shortName:"S",enabled:!0},3:{displayName:"Buy Minus",shortName:"B-",enabled:!1},4:{displayName:"Sell Plus",shortName:"S+",enabled:!1},5:{displayName:"Sell Short",shortName:"SS",enabled:!1}},M={1:{displayName:"Market",enabled:!0},2:{displayName:"Limit",enabled:!0},3:{displayName:"Stop",enabled:!0},4:{displayName:"Stop Limit",enabled:!0},6:{displayName:"With or Without",enabled:!0},P:{displayName:"Pegged",enabled:!0}},R={0:{displayName:"Day",shortName:"DAY",enabled:!0},1:{displayName:"Good Till Cancel",shortName:"GTC",enabled:!1},2:{displayName:"At The Open",shortName:"ATO",enabled:!1},3:{displayName:"Immediate Or Cancel",shortName:"IOC",enabled:!1},4:{displayName:"Fill Or Kill",shortName:"FOK",enabled:!1},5:{displayName:"Good Till Crossing",shortName:"GTC",enabled:!1},6:{displayName:"Good Till Date",shortName:"GTD",enabled:!1},7:{displayName:"At The Close",shortName:"ATC",enabled:!1}},q=function(e,t){var r=new Date(e);return r.setDate(r.getDate()+t),r},B=function(e,t){var r=new Date(e);return r.setUTCSeconds(r.getUTCSeconds()+t),r},C=function(e){var t=new Date(e);return t.setHours(0,0,0,0),t},L=function(e,t){var r=C(t).getTime()-C(e).getTime();return Math.round(r/864e5)};function A(){return A=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},A.apply(this,arguments)}function F(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function H(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?F(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var _=new Date("2010-01-01"),V=void 0,X=[9,30,0,0],K=[16,0,0,0],U=function(e){return Array.isArray(e)&&(K[0]=e[0]||0,K[1]=e[1]||0,K[2]=e[2]||0,K[3]=e[3]||0),[].concat(K)},Y=100,W={},Z=function(e){if(!V)return e;var t=new Date,r=L(t,V);return q(e,r)},z=function(e){if(!V)return e;var t=new Date,r=L(V,t);return q(e,r)},Q=function(e){var t=new Date(e);return t.setHours.apply(t,X),t},$=function(e){var t=new Date(e);return t.setHours.apply(t,K),t},J=function(e,t){return e=Z(e),(L(_,e)<<12)+t},ee=function(e){return new P(e.toString(16))},te=function(e){return new P(e.toISOString())},re=function(e){var t=(e=Z(e)).getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),r=W[t];if(r)return r;r=[];for(var n=Q(e),i=($(e).getTime()-n.getTime())/1e3,o=function(e){return new P(e)}(e),a=0,s=1,c=3,u=r.length;u<10&&u<Y&&!((a+=o.next32Range(60*s,60*c))>=i);++u)r.push(B(n,a));s=3,c=8;for(var l=r.length;l<Y&&!((a+=o.next32Range(60*s,60*c))>=i);++l)r.push(B(n,a));return W[t]=r,r},ne=function(e){for(var t=new Date,r=e||new Date,n=[],i=[],o=[],a=re(r).length,s=0;s<a;++s){var c=ae(r,s);if(c.dateCreated.getTime()>r.getTime())break;n.push(c)}for(var u=0,l=n;u<l.length;u++){var d=l[u],p=se(d,r),f=p.trades,h=p.slices;i.push(f),o.push(h)}return console.log("=== ".concat(n.length," orders in ").concat((new Date).getTime()-t.getTime()," ms as of ").concat(r.toISOString())),{orders:n,trades:i,slices:o}},ie=function(e,t){if(t&&e){var r=function(e){var t=q(_,e>>12);return z(t)}(t),n=re(r),i=t-J(r,0);if(!(i<0||i>=n.length)){var o=ae(r,i);if(!(o.dateCreated.getTime()>e.getTime())){var a=se(o,e);return{order:o,trades:a.trades,slices:a.slices}}}}},oe=function(e){for(var t=[],r=ee(e.orderId+7919),n=r.next32Range(1,3),i=e.quantity,o=0;o<n-1&&i>0;o++){var a=e.quantity/n>>>0;a<=0||a>i||(t.push({brokerIndex:r.next32()%S.length,quantity:a}),i-=a)}return i>0&&t.push({brokerIndex:r.next32()%S.length,quantity:i}),e.split=t,t},ae=function(e,t){var r=J(e,t),n=ee(r),i=re(e),o=n.next32(),a=n.next32(),s=n.next32(),c=n.next32Range(1,50),u=f[o%f.length],l=k[a%k.length],d=u.currency,p=l.clientId,h=["1","2"][s%2],m=60*c,y=["AGENCY","RISK"][t%2],v=z(i[t]),g={orderId:r,clientId:p,instrument:{ticker:u.ticker,bbgExchange:u.bbgExchange},currency:d,side:h,quantity:m,quantityFilled:0,dateCreated:v,orderType:"1",timeInForce:"0",comments:"",averagePrice:0,tradeStatus:"open",brokerId:"XX",bookId:y};return oe(g),g},se=function(e,t){var r,n=[],i=[],o=null!==(r=f.find((function(t){return e.instrument.ticker===t.ticker})))&&void 0!==r?r:f[0];(e.split||[]).forEach((function(r,a){var s=S[r.brokerIndex],c=100*e.orderId+a+1,u=function(e,t,r,n,i,o){for(var a=[],s=e.dateCreated,c=((t||$(s)).getTime()-s.getTime())/1e3,u=n,l=ee(r+1013904223),d=0,p=15,f=30,h=0;h<20&&(h<10?(p=15,f=30):(p=30,f=120),!((d+=l.next32Range(p,f))>c));++h){var m=Math.min(u,60*l.next32Range(5,20)),y=B(s,d),v=te(y).next32Range(-5,5),g=o.price.close*(1+v/100);if(a.push({orderId:e.orderId,clientId:e.clientId,sliceId:r,side:e.side,instrument:e.instrument,currency:e.currency,timestamp:y,quantity:m,price:g,execBroker:i.brokerId,exchange:i.brokerExchange,comments:"",bookId:e.bookId}),(u-=m)<=0)break}return a}(e,t,c,r.quantity,s,o);n.push.apply(n,x(u));var l=H({},e),d=A({},(function(e){if(null==e)throw new TypeError("Cannot destructure "+e)}(l),l));d.sliceId=c,d.quantity=r.quantity,d.brokerId=s.brokerId;var p,f,h,m=0,y=0;u.forEach((function(e){m+=e.quantity,y+=e.quantity*e.price})),d.averagePrice=y/m,d.quantityFilled=m,ce(d),i.push(H(H({},p=d),{},{brokerExchange:null!==(f=null===(h=S.find((function(e){return e.brokerId===p.brokerId})))||void 0===h?void 0:h.brokerExchange)&&void 0!==f?f:""}))}));var a=0,s=0;return n.forEach((function(e){a+=e.quantity,s+=e.quantity*e.price})),e.averagePrice=s/a,e.quantityFilled=a,ce(e),{trades:n,slices:i}},ce=function(e){0===e.quantityFilled?e.tradeStatus="New":e.quantityFilled<e.quantity?e.tradeStatus="Partial":e.tradeStatus="Done"};function ue(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function le(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(r),!0).forEach((function(t){d(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ue(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function de(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return pe(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?pe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw o}}}}function pe(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var fe=function(e){var t=null==e?void 0:e.match(/(\d\d?)(?:[.:](\d\d?)(?:[.:](\d\d?)(?:[.:](\d\d?\d?))?)?)?/);if(t)return[parseInt(t[1])||0,parseInt(t[2])||0,parseInt(t[3])||0,parseInt(t[4])||0]};const he=function(){function e(r,n){var i=this;a(this,e),d(this,"glue",void 0),d(this,"methods",void 0),d(this,"customOrders",void 0),d(this,"customTrades",void 0),d(this,"optMockToday",void 0),d(this,"optTradeOpenHours",void 0),d(this,"optTradeCloseHours",void 0),d(this,"optMaxOrdersPerDay",void 0),d(this,"getCustomOrders",(function(e){if(!i.customOrders)return{orders:[],trades:[],slices:[]};var t,r=C(e),n=i.customOrders.filter((function(t){return t.dateCreated.getTime()>=r.getTime()&&t.dateCreated.getTime()<=e.getTime()})),o=[],a=[],s=de(n);try{for(s.s();!(t=s.n()).done;){var c=t.value,u=se(c,e),l=u.trades,d=u.slices;o.push(l),a.push(d)}}catch(e){s.e(e)}finally{s.f()}return{orders:n,trades:o,slices:a}})),d(this,"getCustomOrder",(function(e,t){if(i.customOrders){var r=C(e),n=i.customOrders.find((function(n){return n.orderId==t&&n.dateCreated.getTime()>=r.getTime()&&n.dateCreated.getTime()<=e.getTime()}));if(n){var o=se(n,e);return{order:n,trades:o.trades,slices:o.slices}}}})),d(this,"getOrdersImpl",function(){var e=t(o().mark((function e(t){var r,n,a,s,c,u,l,d,p,f,h;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.date,n=t.withTrades,a=t.withSlices,s=ne(r),c=s.orders,u=s.trades,l=s.slices,d=i.getCustomOrders(r),p=d.orders,f=d.trades,h=d.slices,c.push.apply(c,x(p)),u.push.apply(u,x(f)),l.push.apply(l,x(h)),e.abrupt("return",le(le({orders:c},n&&{trades:u}),a&&{slices:l}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),d(this,"getOrderImpl",function(){var e=t(o().mark((function e(t){var r,n,a,s,c,u,l,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.orderId,n=t.date,a=t.withTrades,s=t.withSlices,c=i.getCustomOrder(n,r)||ie(n,r),u=[],a&&(l=i.getCustomTrades(n),d=l.trades,u=d.filter((function(e){return e.orderId==r}))),c){e.next=6;break}return e.abrupt("return",void 0);case 6:return e.abrupt("return",le(le({order:c.order},a&&{trades:c.trades.concat(u)}),s&&{slices:c.slices}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),d(this,"getCustomTrades",(function(e){if(!i.customTrades)return{trades:[]};var t=C(e);return{trades:i.customTrades.filter((function(r){return r.timestamp.getTime()>=t.getTime()&&r.timestamp.getTime()<=e.getTime()}))}})),d(this,"getAllTradesImpl",function(){var e=t(o().mark((function e(t){var r,n,a,s,c,u,l,d;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.date,n=ne(r),a=n.trades,s=i.getCustomTrades(r),c=s.trades,u=i.getCustomOrders(r),l=u.trades,d=[].concat(x(a.flat()),x(c),x(l.flat())),e.abrupt("return",{trades:d});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),d(this,"getTradesForInstrumentImpl",function(){var e=t(o().mark((function e(t){var r,n,a,s,c;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.date,n=t.instrument,e.next=3,i.getAllTradesImpl({date:r});case 3:return a=e.sent,s=a.trades,c=s.filter((function(e){var t,r;return(null===(t=e.instrument)||void 0===t?void 0:t.ticker)===(null===(r=n.id)||void 0===r?void 0:r.ticker)})),e.abrupt("return",{trades:c});case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),d(this,"getOrderIdImpl",(function(e){var t="";return e.sliceId&&(t=(e.sliceId+"").slice(0,-2)),t})),d(this,"getDefaultTradingPosition",(function(){return{book:"",instrument:{ticker:"",bbgExchange:""},position:0,averagePrice:0,totalVolume:0,totalPrice:0,currency:"GBX"}})),d(this,"addTradeToPosition",(function(e,t){var r=1;"2"===t.side&&(r=-1),e.book||(e.book=t.bookId||""),e.instrument.ticker||e.instrument.ticker||(e.instrument=t.instrument);var n=e.position+r*t.quantity,i=e.totalVolume+t.quantity,o=e.totalPrice+t.quantity*t.price,a=o/i;e.position=n,e.totalVolume=i,e.totalPrice=o,e.averagePrice=a})),d(this,"mapTradesToPositions",(function(e){var t={};return e.forEach((function(e){var r=e.bookId||"",n=e.instrument.ticker;t[r]||(t[r]={}),t[r][n]||(t[r][n]=i.getDefaultTradingPosition()),i.addTradeToPosition(t[r][n],e)})),console.log("mapTradesToPositions(): ",t),t})),d(this,"getTradingPositionsImpl",function(){var e=t(o().mark((function e(t){var r,n,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.date,e.next=3,i.getAllTradesImpl({date:r});case 3:return n=e.sent,a=i.mapTradesToPositions(n.trades),e.abrupt("return",a);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),d(this,"createOrderImpl",function(){var e=t(o().mark((function e(t){var r,n,a,s,c,u,l,d,p;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.order,console.log("CreatingOrder...",r),o=r.dateCreated,n=o&&!isNaN(o.getTime())?r.dateCreated:new Date,f=void 0,(f=new Date(n)).setHours(23,59,59,999),a=f,s=i.getCustomOrders(a),c=s.orders,u=["AGENCY","RISK"],l=J(n,1e3+c.length),d=u[l%2],p={orderId:l,dateCreated:n,clientId:r.clientId||"TEST1",side:r.side||"1",instrument:r.instrument||{ticker:"VOD",bbgExchange:"LN"},currency:"GBX",quantity:r.quantity||1e3,orderType:r.orderType||"1",timeInForce:r.timeInForce||"0",expireTime:r.expireTime,quantityFilled:0,limitPrice:r.limitPrice,comments:"",averagePrice:0,tradeStatus:"open",brokerId:"XX",bookId:d},oe(p),i.customOrders.push(p);case 11:case"end":return e.stop()}var o,f}),e)})));return function(t){return e.apply(this,arguments)}}()),d(this,"createTradeImpl",function(){var e=t(o().mark((function e(t){var r,n;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=t.trade,console.log("CreatingTrade...",r),n=r,i.customTrades.push(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.glue=r,this.methods=[],this.customOrders=[],this.customTrades=[],this.optMockToday=null==n?void 0:n.mockToday,this.optTradeOpenHours=null==n?void 0:n.tradeOpenHours,this.optTradeCloseHours=null==n?void 0:n.tradeCloseHours,this.optMaxOrdersPerDay=null==n?void 0:n.maxOrdersPerDay}var r;return l(e,[{key:"initialize",value:(r=t(o().mark((function e(){var t,r,n,i,a=this;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.optMockToday&&(t=new Date(this.optMockToday),console.log("OrderManagementService: using mockToday:",t),V=t),c=fe(this.optTradeOpenHours),Array.isArray(c)&&(X[0]=c[0]||0,X[1]=c[1]||0,X[2]=c[2]||0,X[3]=c[3]||0),[].concat(X),console.log("OrderManagementService: trade open hours:",[].concat(X)),U(fe(this.optTradeCloseHours)),console.log("OrderManagementService: trade close hours:",[].concat(K)),s=this.optMaxOrdersPerDay,Y=parseInt(s)||Y,console.log("OrderManagementService: max orders per day:",Y),this.methods.push({definition:{name:"T42.OMS.GetOrders",accepts:"Datetime date, bool withSlices, bool withTrades",returns:"composite: [] orders, composite: [] trades, composite: [] slices",displayName:"Get Orders from OMS",description:"Retrieve a list of orders from OMS"},handler:function(e){return a.getOrdersImpl(e)}}),this.methods.push({definition:{name:"T42.OMS.GetOrder",accepts:"String orderId, Datetime date, bool withSlices, bool withTrades",returns:"composite: order, composite: [] trades, composite: [] slices",displayName:"Get Order from OMS",description:"Retrieve an order from OMS"},handler:function(e){return a.getOrderImpl(e)}}),this.methods.push({definition:{name:"T42.OMS.GetAllTrades",accepts:"Datetime date",returns:"composite: [] trades",displayName:"Get all daily trades as of date/time",description:"Retrieve all daily trades as of date/time"},handler:function(e){return a.getAllTradesImpl(e)}}),this.methods.push({definition:{name:"T42.OMS.GetTradesForInstrument",accepts:"Datetime date, Fdc3Instrument instrument",returns:"composite: [] trades",displayName:"Get all daily trades for instrument as of date/time",description:"Retrieve all daily trades for instrument as of date/time"},handler:function(e){return a.getTradesForInstrumentImpl(e)}}),this.methods.push({definition:{name:"T42.OMS.GetOrderId",accepts:"String sliceId",returns:"String orderId",displayName:"Get orderId for the provided sliceId",description:"Retrieve the orderId of the provided sliceId"},handler:function(e){return a.getOrderIdImpl(e)}}),this.methods.push({definition:{name:"T42.OMS.TradingPositions",accepts:"Datetime date",returns:"composite tradingPositions",displayName:"Get trading positions as of date/time",description:"Retrieve trading positions as of date/time"},handler:function(e){return a.getTradingPositionsImpl(e)}}),this.methods.push({definition:{name:"T42.OMS.CreateOrder",accepts:"Datetime date",returns:"",displayName:"Create Order",description:"Creates a new order in the OMS."},handler:function(e){return a.createOrderImpl(e)}}),this.methods.push({definition:{name:"T42.OMS.CreateTrade",accepts:"composite: { trade: OrderTrade } trade",returns:"",displayName:"Create Trade",description:"Creates a new trade in the OMS."},handler:function(e){return a.createTradeImpl(e)}}),this.methods.push({definition:{name:"T42.OMS.GetBrokers",accepts:"",returns:"composite: { string brokerId, string brokerExchange } [] brokers",displayName:"Get Brokers",description:"Retrieve a list of brokers."},handler:function(){return{brokers:S}}}),this.methods.push({definition:{name:"T42.OMS.GetInstruments",accepts:"",returns:"InstrumentInfo [] instruments",displayName:"Get instrument list",description:"Retrieve a list of instruments"},handler:function(){return{instruments:f}}}),this.methods.push({definition:{name:"T42.OMS.GetFdc3Instruments",accepts:"",returns:"Fdc3InstrumentList [] instruments",displayName:"Get FDC3 instrument list",description:"Retrieve a list of fdc3 instruments"},handler:function(){return{instruments:I}}}),this.methods.push({definition:{name:"T42.OMS.GetClients",accepts:"",returns:"ClientInfo [] clients",displayName:"Get client list",description:"Retrieve a list of clients"},handler:function(){return{clients:k}}}),this.methods.push({definition:{name:"T42.OMS.GetOrderValidity",accepts:"",returns:"composite orderValidity",displayName:"Get Orders validity values",description:"Retrieve a list of order validity values"},handler:function(){return{orderValidity:R}}}),this.methods.push({definition:{name:"T42.OMS.GetOrderTypes",accepts:"",returns:"composite: orderTypes",displayName:"Get Orders types",description:"Retrieve a list of orders types"},handler:function(){return{orderTypes:M}}}),this.methods.push({definition:{name:"T42.OMS.GetOrderSides",accepts:"",returns:"composite: orderSides",displayName:"Get Orders sides",description:"Retrieve a list of orders sides"},handler:function(){return{orderSides:j}}}),this.methods.push({definition:{name:"T42.OMS.GetFunds",accepts:"",returns:"composite: FundInfo",displayName:"Get Funds",description:"Get Funds"},handler:function(){return{funds:N}}}),r=de(this.methods),e.prev=24,i=o().mark((function e(){var t,r,i;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=n.value,r=t.definition,i=t.handler,a.glue.interop.register(r,i).then((function(){console.log("Method "+r.name+" registered.")})).catch((function(e){console.error("Method registration failed for "+r.name,e)}));case 2:case"end":return e.stop()}}),e)})),r.s();case 27:if((n=r.n()).done){e.next=31;break}return e.delegateYield(i(),"t0",29);case 29:e.next=27;break;case 31:e.next=36;break;case 33:e.prev=33,e.t1=e.catch(24),r.e(e.t1);case 36:return e.prev=36,r.f(),e.finish(36);case 39:case"end":return e.stop()}var s,c}),e,this,[[24,33,36,39]])}))),function(){return r.apply(this,arguments)})}]),e}(),me=l((function e(r){var n=this;a(this,e),d(this,"glue",void 0),d(this,"symbolCache",{}),d(this,"min",-5),d(this,"max",5),d(this,"subscribers",{}),d(this,"pollingTasks",{}),d(this,"initialize",t(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.registerStream();case 2:case"end":return e.stop()}}),e)})))),d(this,"registerStream",t(o().mark((function e(){var t,r;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={name:"T42.OMS.MarketData",displayName:"Mock Market Data",accepts:"Fdc3InstrumentList list",returns:"String symbol, Number volume, Number lastTradedVolume, Number lastPrice, Number openPrice, Number lowPrice, Number highPrice, Number prevClosePrice, Number totalVWAP, Date time,  String description, String isin, String currency"},r={subscriptionRequestHandler:function(e){return n.onSubscriptionRequest(e)},subscriptionAddedHandler:function(e){return n.onSubscriptionAdded(e)},subscriptionRemovedHandler:function(e){return n.onSubscriptionRemoved(e)}},e.next=4,n.glue.interop.createStream(t,r);case 4:case"end":return e.stop()}}),e)})))),d(this,"onSubscriptionRequest",(function(e){var t,r,n=e.instance.application,i=null===(t=e.arguments)||void 0===t||null===(r=t.list)||void 0===r?void 0:r.instruments;i&&i.length>0?(e.accept(),console.log('Accepted subscription by "'.concat(n,'" '))):(e.reject("Subscription rejected: missing instrument list!"),console.warn('Rejected subscription by "'.concat(n,'". Instrument List not specified')))})),d(this,"onSubscriptionAdded",(function(e){var t=e.arguments.list.instruments;t&&t.forEach((function(t){n.processSymbol(t,e)}))})),d(this,"onSubscriptionRemoved",(function(e){var t=e;for(var r in n.subscribers){var i=n.subscribers[r].findIndex((function(e){return e.subscription.id===t.subscription.id}),t);i>=0&&n.subscribers[r].splice(i,1),n.subscribers[r].length<=0&&(delete n.subscribers[r],n.stopDataRequests(r))}})),d(this,"processSymbol",(function(e,t){var r,i=null===(r=e.id)||void 0===r?void 0:r.ticker;null!=i&&(n.subscribers[i]&&n.subscribers[i].length>0?(n.subscribers[i].push(t),n.symbolCache[i]&&t.push(n.symbolCache[i])):(n.subscribers[i]=[t],n.startDataRequests(i)))})),d(this,"getPrice",(function(e,t,r){return r*(1+new P(n.formatDate(e,t)).next32Range(n.min,n.max)/100)})),d(this,"getMockedTotalVWAP",(function(e,t,r,n,i){return(e*(.75*i)+t*(.1*i)+r*(.1*i)+n*(.05*i))/i})),d(this,"getLastTradedVolume",(function(e,t){return 1e3*new P(n.formatDate(e,t)).next32Range(1,20)})),d(this,"formatDate",(function(e,t){var r=t.toISOString().split(".")[0],n=parseInt(r.charAt(r.length-1))<=5?"a":"b";return(r=r.replace(/.$/,n))+e})),d(this,"fetchMarketData",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Date,r=f.find((function(t){return t.ticker===e})),i=(null==r?void 0:r.price.close)||1e3*Math.random(),o=n.getPrice(e,t,i),a=$(new Date(t.getDate()-1)),s=n.getPrice(e,a,i),c=(null==r?void 0:r.volume.average)||1e3*Math.random(),u=n.getVolume(t,c),l=n.getLastTradedVolume(e,t),d=i*(1+new P(n.formatDate(e,Q(t))).next32Range(n.min,n.max)/100),p=i-n.min/100*i,h=i+n.max/100*i,m=n.getMockedTotalVWAP(d,p,h,o,u),y=(null==r?void 0:r.description)||"",v=(null==r?void 0:r.isin)||"",g=(null==r?void 0:r.currency)||"",b={ticker:e,volume:u,lastTradedVolume:l,lastPrice:o,openPrice:d,lowPrice:p,highPrice:h,prevClosePrice:s,totalVWAP:m,time:t,description:y,isin:v,currency:g};n.symbolCache[e]=b,n.subscribers[e].forEach((function(e){e.push(b)}))})),d(this,"getVolume",(function(e,t){var r=Q(e).valueOf(),n=$(e).valueOf(),i=e.valueOf(),o=0;return i>n?o=t:i>r&&i<n&&(o=t*((i-r)/(n-r))),Math.round(o)})),d(this,"getRandomInterval",(function(e,t){return 1e3*Math.floor(Math.random()*(t-e+1)+e)})),d(this,"startDataRequests",(function(e){n.pollingTasks[e]=setInterval(n.fetchMarketData,n.getRandomInterval(1,5),e)})),d(this,"stopDataRequests",(function(e){var t=n.pollingTasks[e];clearInterval(t),delete n.pollingTasks[e]})),this.glue=r})),ye=function(){var e=t(o().mark((function e(t,r){var n,i,a;return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new he(t,r),e.next=3,n.initialize();case 3:return i=new me(t),e.next=6,i.initialize();case 6:return a=new w(t),e.next=9,a.initialize();case 9:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()})(),n.default})()));
//# sourceMappingURL=data-service-0.1.0.js.map